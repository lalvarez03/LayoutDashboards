import { NgZone, computed, inject, numberAttribute, signal, untracked } from '@angular/core';
import { Observable, filter, fromEvent, merge } from 'rxjs';
/**
 * Only supporting a single {@link TouchEvent} point
 */
export function getPointFromEvent(event) {
    // NOTE: In firefox TouchEvent is only defined for touch capable devices
    const isTouchEvent = (e) => window.TouchEvent && event instanceof TouchEvent;
    if (isTouchEvent(event)) {
        if (event.changedTouches.length === 0) {
            return undefined;
        }
        const { clientX, clientY } = event.changedTouches[0];
        return {
            x: clientX,
            y: clientY,
        };
    }
    if (event instanceof KeyboardEvent) {
        const target = event.target;
        // Calculate element midpoint
        return {
            x: target.offsetLeft + target.offsetWidth / 2,
            y: target.offsetTop + target.offsetHeight / 2,
        };
    }
    return {
        x: event.clientX,
        y: event.clientY,
    };
}
export function gutterEventsEqualWithDelta(startEvent, endEvent, deltaInPx, gutterElement) {
    if (!gutterElement.contains(startEvent.target) ||
        !gutterElement.contains(endEvent.target)) {
        return false;
    }
    const startPoint = getPointFromEvent(startEvent);
    const endPoint = getPointFromEvent(endEvent);
    return Math.abs(endPoint.x - startPoint.x) <= deltaInPx && Math.abs(endPoint.y - startPoint.y) <= deltaInPx;
}
export function fromMouseDownEvent(target) {
    return merge(fromEvent(target, 'mousedown').pipe(filter((e) => e.button === 0)), 
    // We must prevent default here so we declare it as non passive explicitly
    fromEvent(target, 'touchstart', { passive: false }));
}
export function fromMouseMoveEvent(target) {
    return merge(fromEvent(target, 'mousemove'), fromEvent(target, 'touchmove'));
}
export function fromMouseUpEvent(target, includeTouchCancel = false) {
    const withoutTouchCancel = merge(fromEvent(target, 'mouseup'), fromEvent(target, 'touchend'));
    return includeTouchCancel
        ? merge(withoutTouchCancel, fromEvent(target, 'touchcancel'))
        : withoutTouchCancel;
}
export function sum(array, fn) {
    return array.reduce((sum, item) => sum + fn(item), 0);
}
export function toRecord(array, fn) {
    return array.reduce((record, item, index) => {
        const [key, value] = fn(item, index);
        record[key] = value;
        return record;
    }, {});
}
export function createClassesString(classesRecord) {
    return Object.entries(classesRecord)
        .filter(([, value]) => value)
        .map(([key]) => key)
        .join(' ');
}
/**
 * Creates a semi signal which allows writes but is based on an existing signal
 * Whenever the original signal changes the mirror signal gets aligned
 * overriding the current value inside.
 */
export function mirrorSignal(outer) {
    const inner = computed(() => signal(outer()));
    const mirror = () => inner()();
    mirror.set = (value) => untracked(inner).set(value);
    mirror.reset = () => untracked(() => inner().set(outer()));
    return mirror;
}
export function leaveNgZone() {
    return (source) => new Observable((observer) => inject(NgZone).runOutsideAngular(() => source.subscribe(observer)));
}
export const numberAttributeWithFallback = (fallback) => (value) => numberAttribute(value, fallback);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyLXNwbGl0L3NyYy9saWIvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBVSxRQUFRLEVBQUUsTUFBTSxFQUFFLGVBQWUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFBO0FBQ3BHLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUE7QUFPM0Q7O0dBRUc7QUFDSCxNQUFNLFVBQVUsaUJBQWlCLENBQUMsS0FBOEM7SUFDOUUsd0VBQXdFO0lBQ3hFLE1BQU0sWUFBWSxHQUFHLENBQUMsQ0FBZSxFQUFtQixFQUFFLENBQUMsTUFBTSxDQUFDLFVBQVUsSUFBSSxLQUFLLFlBQVksVUFBVSxDQUFBO0lBRTNHLElBQUksWUFBWSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDeEIsSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUN0QyxPQUFPLFNBQVMsQ0FBQTtRQUNsQixDQUFDO1FBRUQsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsR0FBRyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBRXBELE9BQU87WUFDTCxDQUFDLEVBQUUsT0FBTztZQUNWLENBQUMsRUFBRSxPQUFPO1NBQ1gsQ0FBQTtJQUNILENBQUM7SUFFRCxJQUFJLEtBQUssWUFBWSxhQUFhLEVBQUUsQ0FBQztRQUNuQyxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBcUIsQ0FBQTtRQUUxQyw2QkFBNkI7UUFDN0IsT0FBTztZQUNMLENBQUMsRUFBRSxNQUFNLENBQUMsVUFBVSxHQUFHLE1BQU0sQ0FBQyxXQUFXLEdBQUcsQ0FBQztZQUM3QyxDQUFDLEVBQUUsTUFBTSxD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TUFBTSwyQkFBMkIsR0FBRyxDQUFDLFFBQWdCLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBYyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmdab25lLCBTaWduYWwsIGNvbXB1dGVkLCBpbmplY3QsIG51bWJlckF0dHJpYnV0ZSwgc2lnbmFsLCB1bnRyYWNrZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlJ1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZmlsdGVyLCBmcm9tRXZlbnQsIG1lcmdlIH0gZnJvbSAncnhqcydcblxuZXhwb3J0IGludGVyZmFjZSBDbGllbnRQb2ludCB7XG4gIHg6IG51bWJlclxuICB5OiBudW1iZXJcbn1cblxuLyoqXG4gKiBPbmx5IHN1cHBvcnRpbmcgYSBzaW5nbGUge0BsaW5rIFRvdWNoRXZlbnR9IHBvaW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRQb2ludEZyb21FdmVudChldmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQgfCBLZXlib2FyZEV2ZW50KTogQ2xpZW50UG9pbnQge1xuICAvLyBOT1RFOiBJbiBmaXJlZm94IFRvdWNoRXZlbnQgaXMgb25seSBkZWZpbmVkIGZvciB0b3VjaCBjYXBhYmxlIGRldmljZXNcbiAgY29uc3QgaXNUb3VjaEV2ZW50ID0gKGU6IHR5cGVvZiBldmVudCk6IGUgaXMgVG91Y2hFdmVudCA9PiB3aW5kb3cuVG91Y2hFdmVudCAmJiBldmVudCBpbnN0YW5jZW9mIFRvdWNoRXZlbnRcblxuICBpZiAoaXNUb3VjaEV2ZW50KGV2ZW50KSkge1xuICAgIGlmIChldmVudC5jaGFuZ2VkVG91Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG5cbiAgICBjb25zdCB7IGNsaWVudFgsIGNsaWVudFkgfSA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdXG5cbiAgICByZXR1cm4ge1xuICAgICAgeDogY2xpZW50WCxcbiAgICAgIHk6IGNsaWVudFksXG4gICAgfVxuICB9XG5cbiAgaWYgKGV2ZW50IGluc3RhbmNlb2YgS2V5Ym9hcmRFdmVudCkge1xuICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudFxuXG4gICAgLy8gQ2FsY3VsYXRlIGVsZW1lbnQgbWlkcG9pbnRcbiAgICByZXR1cm4ge1xuICAgICAgeDogdGFyZ2V0Lm9mZnNldExlZnQgKyB0YXJnZXQub2Zmc2V0V2lkdGggLyAyLFxuICAgICAgeTogdGFyZ2V0Lm9mZnNldFRvcCArIHRhcmdldC5vZmZzZXRIZWlnaHQgLyAyLFxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgeDogZXZlbnQuY2xpZW50WCxcbiAgICB5OiBldmVudC5jbGllbnRZLFxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBndXR0ZXJFdmVudHNFcXVhbFdpdGhEZWx0YShcbiAgc3RhcnRFdmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQsXG4gIGVuZEV2ZW50OiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCxcbiAgZGVsdGFJblB4OiBudW1iZXIsXG4gIGd1dHRlckVsZW1lbnQ6IEhUTUxFbGVtZW50LFxuKSB7XG4gIGlmIChcbiAgICAhZ3V0dGVyRWxlbWVudC5jb250YWlucyhzdGFydEV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudCkgfHxcbiAgICAhZ3V0dGVyRWxlbWVudC5jb250YWlucyhlbmRFdmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpXG4gICkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgY29uc3Qgc3RhcnRQb2ludCA9IGdldFBvaW50RnJvbUV2ZW50KHN0YXJ0RXZlbnQpXG4gIGNvbnN0IGVuZFBvaW50ID0gZ2V0UG9pbnRGcm9tRXZlbnQoZW5kRXZlbnQpXG5cbiAgcmV0dXJuIE1hdGguYWJzKGVuZFBvaW50LnggLSBzdGFydFBvaW50LngpIDw9IGRlbHRhSW5QeCAmJiBNYXRoLmFicyhlbmRQb2ludC55IC0gc3RhcnRQb2ludC55KSA8PSBkZWx0YUluUHhcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21Nb3VzZURvd25FdmVudCh0YXJnZXQ6IEhUTUxFbGVtZW50IHwgRG9jdW1lbnQpIHtcbiAgcmV0dXJuIG1lcmdlKFxuICAgIGZyb21FdmVudDxNb3VzZUV2ZW50Pih0YXJnZXQsICdtb3VzZWRvd24nKS5waXBlKGZpbHRlcigoZSkgPT4gZS5idXR0b24gPT09IDApKSxcbiAgICAvLyBXZSBtdXN0IHByZXZlbnQgZGVmYXVsdCBoZXJlIHNvIHdlIGRlY2xhcmUgaXQgYXMgbm9uIHBhc3NpdmUgZXhwbGljaXRseVxuICAgIGZyb21FdmVudDxUb3VjaEV2ZW50Pih0YXJnZXQsICd0b3VjaHN0YXJ0JywgeyBwYXNzaXZlOiBmYWxzZSB9KSxcbiAgKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZnJvbU1vdXNlTW92ZUV2ZW50KHRhcmdldDogSFRNTEVsZW1lbnQgfCBEb2N1bWVudCkge1xuICByZXR1cm4gbWVyZ2UoZnJvbUV2ZW50PE1vdXNlRXZlbnQ+KHRhcmdldCwgJ21vdXNlbW92ZScpLCBmcm9tRXZlbnQ8VG91Y2hFdmVudD4odGFyZ2V0LCAndG91Y2htb3ZlJykpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmcm9tTW91c2VVcEV2ZW50KHRhcmdldDogSFRNTEVsZW1lbnQgfCBEb2N1bWVudCwgaW5jbHVkZVRvdWNoQ2FuY2VsID0gZmFsc2UpIHtcbiAgY29uc3Qgd2l0aG91dFRvdWNoQ2FuY2VsID0gbWVyZ2UoZnJvbUV2ZW50PE1vdXNlRXZlbnQ+KHRhcmdldCwgJ21vdXNldXAnKSwgZnJvbUV2ZW50PFRvdWNoRXZlbnQ+KHRhcmdldCwgJ3RvdWNoZW5kJykpXG5cbiAgcmV0dXJuIGluY2x1ZGVUb3VjaENhbmNlbFxuICAgID8gbWVyZ2Uod2l0aG91dFRvdWNoQ2FuY2VsLCBmcm9tRXZlbnQ8VG91Y2hFdmVudD4odGFyZ2V0LCAndG91Y2hjYW5jZWwnKSlcbiAgICA6IHdpdGhvdXRUb3VjaENhbmNlbFxufVxuXG5leHBvcnQgZnVuY3Rpb24gc3VtPFQ+KGFycmF5OiBUW10gfCByZWFkb25seSBUW10sIGZuOiAoaXRlbTogVCkgPT4gbnVtYmVyKSB7XG4gIHJldHVybiAoYXJyYXkgYXMgVFtdKS5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgZm4oaXRlbSksIDApXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1JlY29yZDxUSXRlbSwgVEtleSBleHRlbmRzIHN0cmluZywgVFZhbHVlPihcbiAgYXJyYXk6IFRJdGVtW10gfCByZWFkb25seSBUSXRlbVtdLFxuICBmbjogKGl0ZW06IFRJdGVtLCBpbmRleDogbnVtYmVyKSA9PiBbVEtleSwgVFZhbHVlXSxcbik6IFJlY29yZDxUS2V5LCBUVmFsdWU+IHtcbiAgcmV0dXJuIChhcnJheSBhcyBUSXRlbVtdKS5yZWR1Y2U8UmVjb3JkPFRLZXksIFRWYWx1ZT4+KFxuICAgIChyZWNvcmQsIGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBmbihpdGVtLCBpbmRleClcbiAgICAgIHJlY29yZFtrZXldID0gdmFsdWVcbiAgICAgIHJldHVybiByZWNvcmRcbiAgICB9LFxuICAgIHt9IGFzIFJlY29yZDxUS2V5LCBUVmFsdWU+LFxuICApXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDbGFzc2VzU3RyaW5nKGNsYXNzZXNSZWNvcmQ6IFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+KSB7XG4gIHJldHVybiBPYmplY3QuZW50cmllcyhjbGFzc2VzUmVjb3JkKVxuICAgIC5maWx0ZXIoKFssIHZhbHVlXSkgPT4gdmFsdWUpXG4gICAgLm1hcCgoW2tleV0pID0+IGtleSlcbiAgICAuam9pbignICcpXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWlycm9yU2lnbmFsPFQ+IHtcbiAgKCk6IFRcbiAgc2V0KHZhbHVlOiBUKTogdm9pZFxuICByZXNldCgpOiB2b2lkXG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIHNlbWkgc2lnbmFsIHdoaWNoIGFsbG93cyB3cml0ZXMgYnV0IGlzIGJhc2VkIG9uIGFuIGV4aXN0aW5nIHNpZ25hbFxuICogV2hlbmV2ZXIgdGhlIG9yaWdpbmFsIHNpZ25hbCBjaGFuZ2VzIHRoZSBtaXJyb3Igc2lnbmFsIGdldHMgYWxpZ25lZFxuICogb3ZlcnJpZGluZyB0aGUgY3VycmVudCB2YWx1ZSBpbnNpZGUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtaXJyb3JTaWduYWw8VD4ob3V0ZXI6IFNpZ25hbDxUPik6IE1pcnJvclNpZ25hbDxUPiB7XG4gIGNvbnN0IGlubmVyID0gY29tcHV0ZWQoKCkgPT4gc2lnbmFsKG91dGVyKCkpKVxuICBjb25zdCBtaXJyb3I6IE1pcnJvclNpZ25hbDxUPiA9ICgpID0+IGlubmVyKCkoKVxuICBtaXJyb3Iuc2V0ID0gKHZhbHVlOiBUKSA9PiB1bnRyYWNrZWQoaW5uZXIpLnNldCh2YWx1ZSlcbiAgbWlycm9yLnJlc2V0ID0gKCkgPT4gdW50cmFja2VkKCgpID0+IGlubmVyKCkuc2V0KG91dGVyKCkpKVxuICByZXR1cm4gbWlycm9yXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsZWF2ZU5nWm9uZTxUPigpIHtcbiAgcmV0dXJuIChzb3VyY2U6IE9ic2VydmFibGU8VD4pID0+XG4gICAgbmV3IE9ic2VydmFibGU8VD4oKG9ic2VydmVyKSA9PiBpbmplY3QoTmdab25lKS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiBzb3VyY2Uuc3Vic2NyaWJlKG9ic2VydmVyKSkpXG59XG5cbmV4cG9ydCBjb25zdCBudW1iZXJBdHRyaWJ1dGVXaXRoRmFsbGJhY2sgPSAoZmFsbGJhY2s6IG51bWJlcikgPT4gKHZhbHVlOiB1bmtub3duKSA9PiBudW1iZXJBdHRyaWJ1dGUodmFsdWUsIGZhbGxiYWNrKVxuIl19