import { ChangeDetectionStrategy, Component, HostBinding, booleanAttribute, computed, inject, input, isDevMode, } from '@angular/core';
import { SPLIT_AREA_CONTRACT, SplitComponent } from '../split/split.component';
import { createClassesString, mirrorSignal } from '../utils';
import { areaSizeTransform, boundaryAreaSizeTransform } from '../models';
import * as i0 from "@angular/core";
export class SplitAreaComponent {
    constructor() {
        this.split = inject(SplitComponent);
        this.size = input('auto', { transform: areaSizeTransform });
        this.minSize = input('*', { transform: boundaryAreaSizeTransform });
        this.maxSize = input('*', { transform: boundaryAreaSizeTransform });
        this.lockSize = input(false, { transform: booleanAttribute });
        this.visible = input(true, { transform: booleanAttribute });
        /**
         * @internal
         */
        this._internalSize = mirrorSignal(
        // As size is an input and we can change the size without the outside
        // listening to the change we need an intermediate writeable signal
        computed(() => {
            if (!this.visible()) {
                return 0;
            }
            const size = this.size();
            // auto acts the same as * in all calculations
            return size === 'auto' ? '*' : size;
        }));
        /**
         * @internal
         */
        this._normalizedMinSize = computed(() => this.normalizeMinSize());
        /**
         * @internal
         */
        this._normalizedMaxSize = computed(() => this.normalizeMaxSize());
        this.index = computed(() => this.split._areas().findIndex((area) => area === this));
        this.gridAreaNum = computed(() => this.index() * 2 + 1);
        this.hostClasses = computed(() => createClassesString({
            ['as-split-area']: true,
            ['as-min']: this.visible() && this._internalSize() === this._normalizedMinSize(),
            ['as-max']: this.visible() && this._internalSize() === this._normalizedMaxSize(),
            ['as-hidden']: !this.visible(),
        }));
    }
    get hostClassesBinding() {
        return this.hostClasses();
    }
    get hostGridColumnStyleBinding() {
        return this.split.direction() === 'horizontal' ? `${this.gridAreaNum()} / ${this.gridAreaNum()}` : undefined;
    }
    get hostGridRowStyleBinding() {
        return this.split.direction() === 'vertical' ? `${this.gridAreaNum()} / ${this.gridAreaNum()}` : undefined;
    }
    get hostPositionStyleBinding() {
        return this.split._isDragging() ? 'relative' : undefined;
    }
    normalizeMinSize() {
        const defaultMinSize = 0;
        if (!this.visible()) {
            return defaultMinSize;
        }
        const minSize = this.normalizeSizeBoundary(this.minSize, defaultMinSize);
        const size = this.size();
        if (size !== '*' && size !== 'auto' && size < minSize) {
            if (isDevMode()) {
                console.warn('as-split: size cannot be smaller than minSize');
            }
            return defaultMinSize;
        }
        return minSize;
    }
    normalizeMaxSize() {
        const defaultMaxSize = Infinity;
        if (!this.visible()) {
            return defaultMaxSize;
        }
        const maxSize = this.normalizeSizeBoundary(this.maxSize, defaultMaxSize);
        const size = this.size();
        if (size !== '*' && size !== 'auto' && size > maxSize) {
            if (isDevMode()) {
                console.warn('as-split: size cannot be larger than maxSize');
            }
            return defaultMaxSize;
        }
        return maxSize;
    }
    normalizeSizeBoundary(sizeBoundarySignal, defaultBoundarySize) {
        const size = this.size();
        const lockSize = this.lockSize();
        const boundarySize = sizeBoundarySignal();
        if (lockSize) {
            if (isDevMode() && boundarySize !== '*') {
                console.warn('as-split: lockSize overwrites maxSize/minSize');
            }
            if (size === '*' || size === 'auto') {
                if (isDevMode()) {
                    console.warn(`as-split: lockSize isn't supported on area with * size or without size`);
                }
                return defaultBoundarySize;
            }
            return size;
        }
        if (boundarySize === '*') {
            return defaultBoundarySize;
        }
        if (size === '*' || size === 'auto') {
            if (isDevMode()) {
                console.warn('as-split: maxSize/minSize not allowed on * or without size');
            }
            return defaultBoundarySize;
        }
        return boundarySize;
    }
    /** @nocollapse */ static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.8", ngImport: i0, type: SplitAreaComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    /** @nocollapse */ static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.8", type: SplitAreaComponent, isStandalone: true, selector: "as-split-area", inputs: { size: { classPropertyName: "size", publicName: "size", isSignal: true, isRequired: false, transformFunction: null }, minSize: { classPropertyName: "minSize", publicName: "minSize", isSignal: true, isRequired: false, transformFunction: null }, maxSize: { classPropertyName: "maxSize", publicName: "maxSize", isSignal: true, isRequired: false, transformFunction: null }, lockSize: { classPropertyName: "lockSize", publicName: "lockSize", isSignal: true, isRequired: false, transformFunction: null }, visible: { classPropertyName: "visible", publicName: "visible", isSignal: true, isRequired: false, transformFunction: null } }, host: { properties: { "class": "this.hostClassesBinding", "style.grid-column": "this.hostGridColumnStyleBinding", "style.grid-row": "this.hostGridRowStyleBinding", "style.position": "this.hostPositionStyleBinding" } }, providers: [
            {
                provide: SPLIT_AREA_CONTRACT,
                useExisting: SplitAreaComponent,
            },
        ], exportAs: ["asSplitArea"], ngImport: i0, template: "<ng-content></ng-content>\n@if (split._isDragging()) {\n  <div class=\"as-iframe-fix\"></div>\n}\n", styles: [":host{overflow-x:hidden;overflow-y:auto}.as-horizontal>:host{height:100%}.as-vertical>:host{width:100%}.as-iframe-fix{position:absolute;top:0;left:0;width:100%;height:100%}\n"], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.8", ngImport: i0, type: SplitAreaComponent, decorators: [{
            type: Component,
            args: [{ selector: 'as-split-area', standalone: true, exportAs: 'asSplitArea', providers: [
                        {
                            provide: SPLIT_AREA_CONTRACT,
                            useExisting: SplitAreaComponent,
                        },
                    ], changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-content></ng-content>\n@if (split._isDragging()) {\n  <div class=\"as-iframe-fix\"></div>\n}\n", styles: [":host{overflow-x:hidden;overflow-y:auto}.as-horizontal>:host{height:100%}.as-vertical>:host{width:100%}.as-iframe-fix{position:absolute;top:0;left:0;width:100%;height:100%}\n"] }]
        }], propDecorators: { hostClassesBinding: [{
                type: HostBinding,
                args: ['class']
            }], hostGridColumnStyleBinding: [{
                type: HostBinding,
                args: ['style.grid-column']
            }], hostGridRowStyleBinding: [{
                type: HostBinding,
                args: ['style.grid-row']
            }], hostPositionStyleBinding: [{
                type: HostBinding,
                args: ['style.position']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BsaXQtYXJlYS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyLXNwbGl0L3NyYy9saWIvc3BsaXQtYXJlYS9zcGxpdC1hcmVhLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXItc3BsaXQvc3JjL2xpYi9zcGxpdC1hcmVhL3NwbGl0LWFyZWEuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsV0FBVyxFQUVYLGdCQUFnQixFQUNoQixRQUFRLEVBQ1IsTUFBTSxFQUNOLEtBQUssRUFDTCxTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUE7QUFDdEIsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFBO0FBQzlFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxZQUFZLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDNUQsT0FBTyxFQUFpQixpQkFBaUIsRUFBRSx5QkFBeUIsRUFBRSxNQUFNLFdBQVcsQ0FBQTs7QUFnQnZGLE1BQU0sT0FBTyxrQkFBa0I7SUFkL0I7UUFlcUIsVUFBSyxHQUFHLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQTtRQUV4QyxTQUFJLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxDQUFDLENBQUE7UUFDdEQsWUFBTyxHQUFHLEtBQUssQ0FBQyxHQUFHLEVBQUUsRUFBRSxTQUFTLEVBQUUseUJBQXlCLEVBQUUsQ0FBQyxDQUFBO1FBQzlELFlBQU8sR0FBRyxLQUFLLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBUyxFQUFFLHlCQUF5QixFQUFFLENBQUMsQ0FBQTtRQUM5RCxhQUFRLEdBQUcsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxD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TyxFQUFFLG1CQUFtQjs0QkFDNUIsV0FBVyxvQkFBb0I7eUJBQ2hDO3FCQUNGLG1CQUNnQix1QkFBdUIsQ0FBQyxNQUFNOzhCQThDWCxrQkFBa0I7c0JBQXJELFdBQVc7dUJBQUMsT0FBTztnQkFHNEIsMEJBQTBCO3NCQUF6RSxXQUFXO3VCQUFDLG1CQUFtQjtnQkFHYSx1QkFBdUI7c0JBQW5FLFdBQVc7dUJBQUMsZ0JBQWdCO2dCQUdnQix3QkFBd0I7c0JBQXBFLFdBQVc7dUJBQUMsZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgSG9zdEJpbmRpbmcsXG4gIFNpZ25hbCxcbiAgYm9vbGVhbkF0dHJpYnV0ZSxcbiAgY29tcHV0ZWQsXG4gIGluamVjdCxcbiAgaW5wdXQsXG4gIGlzRGV2TW9kZSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSdcbmltcG9ydCB7IFNQTElUX0FSRUFfQ09OVFJBQ1QsIFNwbGl0Q29tcG9uZW50IH0gZnJvbSAnLi4vc3BsaXQvc3BsaXQuY29tcG9uZW50J1xuaW1wb3J0IHsgY3JlYXRlQ2xhc3Nlc1N0cmluZywgbWlycm9yU2lnbmFsIH0gZnJvbSAnLi4vdXRpbHMnXG5pbXBvcnQgeyBTcGxpdEFyZWFTaXplLCBhcmVhU2l6ZVRyYW5zZm9ybSwgYm91bmRhcnlBcmVhU2l6ZVRyYW5zZm9ybSB9IGZyb20gJy4uL21vZGVscydcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYXMtc3BsaXQtYXJlYScsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGV4cG9ydEFzOiAnYXNTcGxpdEFyZWEnLFxuICB0ZW1wbGF0ZVVybDogJy4vc3BsaXQtYXJlYS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsOiAnLi9zcGxpdC1hcmVhLmNvbXBvbmVudC5jc3MnLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBTUExJVF9BUkVBX0NPTlRSQUNULFxuICAgICAgdXNlRXhpc3Rpbmc6IFNwbGl0QXJlYUNvbXBvbmVudCxcbiAgICB9LFxuICBdLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgU3BsaXRBcmVhQ29tcG9uZW50IHtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHNwbGl0ID0gaW5qZWN0KFNwbGl0Q29tcG9uZW50KVxuXG4gIHJlYWRvbmx5IHNpemUgPSBpbnB1dCgnYXV0bycsIHsgdHJhbnNmb3JtOiBhcmVhU2l6ZVRyYW5zZm9ybSB9KVxuICByZWFkb25seSBtaW5TaXplID0gaW5wdXQoJyonLCB7IHRyYW5zZm9ybTogYm91bmRhcnlBcmVhU2l6ZVRyYW5zZm9ybSB9KVxuICByZWFkb25seSBtYXhTaXplID0gaW5wdXQoJyonLCB7IHRyYW5zZm9ybTogYm91bmRhcnlBcmVhU2l6ZVRyYW5zZm9ybSB9KVxuICByZWFkb25seSBsb2NrU2l6ZSA9IGlucHV0KGZhbHNlLCB7IHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZSB9KVxuICByZWFkb25seSB2aXNpYmxlID0gaW5wdXQodHJ1ZSwgeyB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGUgfSlcblxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICByZWFkb25seSBfaW50ZXJuYWxTaXplID0gbWlycm9yU2lnbmFsKFxuICAgIC8vIEFzIHNpemUgaXMgYW4gaW5wdXQgYW5kIHdlIGNhbiBjaGFuZ2UgdGhlIHNpemUgd2l0aG91dCB0aGUgb3V0c2lkZVxuICAgIC8vIGxpc3RlbmluZyB0byB0aGUgY2hhbmdlIHdlIG5lZWQgYW4gaW50ZXJtZWRpYXRlIHdyaXRlYWJsZSBzaWduYWxcbiAgICBjb21wdXRlZCgoKTogU3BsaXRBcmVhU2l6ZSA9PiB7XG4gICAgICBpZiAoIXRoaXMudmlzaWJsZSgpKSB7XG4gICAgICAgIHJldHVybiAwXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHNpemUgPSB0aGlzLnNpemUoKVxuICAgICAgLy8gYXV0byBhY3RzIHRoZSBzYW1lIGFzICogaW4gYWxsIGNhbGN1bGF0aW9uc1xuICAgICAgcmV0dXJuIHNpemUgPT09ICdhdXRvJyA/ICcqJyA6IHNpemVcbiAgICB9KSxcbiAgKVxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICByZWFkb25seSBfbm9ybWFsaXplZE1pblNpemUgPSBjb21wdXRlZCgoKSA9PiB0aGlzLm5vcm1hbGl6ZU1pblNpemUoKSlcbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVhZG9ubHkgX25vcm1hbGl6ZWRNYXhTaXplID0gY29tcHV0ZWQoKCkgPT4gdGhpcy5ub3JtYWxpemVNYXhTaXplKCkpXG4gIHByaXZhdGUgcmVhZG9ubHkgaW5kZXggPSBjb21wdXRlZCgoKSA9PiB0aGlzLnNwbGl0Ll9hcmVhcygpLmZpbmRJbmRleCgoYXJlYSkgPT4gYXJlYSA9PT0gdGhpcykpXG4gIHByaXZhdGUgcmVhZG9ubHkgZ3JpZEFyZWFOdW0gPSBjb21wdXRlZCgoKSA9PiB0aGlzLmluZGV4KCkgKiAyICsgMSlcbiAgcHJpdmF0ZSByZWFkb25seSBob3N0Q2xhc3NlcyA9IGNvbXB1dGVkKCgpID0+XG4gICAgY3JlYXRlQ2xhc3Nlc1N0cmluZyh7XG4gICAgICBbJ2FzLXNwbGl0LWFyZWEnXTogdHJ1ZSxcbiAgICAgIFsnYXMtbWluJ106IHRoaXMudmlzaWJsZSgpICYmIHRoaXMuX2ludGVybmFsU2l6ZSgpID09PSB0aGlzLl9ub3JtYWxpemVkTWluU2l6ZSgpLFxuICAgICAgWydhcy1tYXgnXTogdGhpcy52aXNpYmxlKCkgJiYgdGhpcy5faW50ZXJuYWxTaXplKCkgPT09IHRoaXMuX25vcm1hbGl6ZWRNYXhTaXplKCksXG4gICAgICBbJ2FzLWhpZGRlbiddOiAhdGhpcy52aXNpYmxlKCksXG4gICAgfSksXG4gIClcblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgcHJvdGVjdGVkIGdldCBob3N0Q2xhc3Nlc0JpbmRpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuaG9zdENsYXNzZXMoKVxuICB9XG4gIEBIb3N0QmluZGluZygnc3R5bGUuZ3JpZC1jb2x1bW4nKSBwcm90ZWN0ZWQgZ2V0IGhvc3RHcmlkQ29sdW1uU3R5bGVCaW5kaW5nKCkge1xuICAgIHJldHVybiB0aGlzLnNwbGl0LmRpcmVjdGlvbigpID09PSAnaG9yaXpvbnRhbCcgPyBgJHt0aGlzLmdyaWRBcmVhTnVtKCl9IC8gJHt0aGlzLmdyaWRBcmVhTnVtKCl9YCA6IHVuZGVmaW5lZFxuICB9XG4gIEBIb3N0QmluZGluZygnc3R5bGUuZ3JpZC1yb3cnKSBwcm90ZWN0ZWQgZ2V0IGhvc3RHcmlkUm93U3R5bGVCaW5kaW5nKCkge1xuICAgIHJldHVybiB0aGlzLnNwbGl0LmRpcmVjdGlvbigpID09PSAndmVydGljYWwnID8gYCR7dGhpcy5ncmlkQXJlYU51bSgpfSAvICR7dGhpcy5ncmlkQXJlYU51bSgpfWAgOiB1bmRlZmluZWRcbiAgfVxuICBASG9zdEJpbmRpbmcoJ3N0eWxlLnBvc2l0aW9uJykgcHJvdGVjdGVkIGdldCBob3N0UG9zaXRpb25TdHlsZUJpbmRpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3BsaXQuX2lzRHJhZ2dpbmcoKSA/ICdyZWxhdGl2ZScgOiB1bmRlZmluZWRcbiAgfVxuXG4gIHByaXZhdGUgbm9ybWFsaXplTWluU2l6ZSgpIHtcbiAgICBjb25zdCBkZWZhdWx0TWluU2l6ZSA9IDBcblxuICAgIGlmICghdGhpcy52aXNpYmxlKCkpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0TWluU2l6ZVxuICAgIH1cblxuICAgIGNvbnN0IG1pblNpemUgPSB0aGlzLm5vcm1hbGl6ZVNpemVCb3VuZGFyeSh0aGlzLm1pblNpemUsIGRlZmF1bHRNaW5TaXplKVxuICAgIGNvbnN0IHNpemUgPSB0aGlzLnNpemUoKVxuXG4gICAgaWYgKHNpemUgIT09ICcqJyAmJiBzaXplICE9PSAnYXV0bycgJiYgc2l6ZSA8IG1pblNpemUpIHtcbiAgICAgIGlmIChpc0Rldk1vZGUoKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ2FzLXNwbGl0OiBzaXplIGNhbm5vdCBiZSBzbWFsbGVyIHRoYW4gbWluU2l6ZScpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBkZWZhdWx0TWluU2l6ZVxuICAgIH1cblxuICAgIHJldHVybiBtaW5TaXplXG4gIH1cblxuICBwcml2YXRlIG5vcm1hbGl6ZU1heFNpemUoKSB7XG4gICAgY29uc3QgZGVmYXVsdE1heFNpemUgPSBJbmZpbml0eVxuXG4gICAgaWYgKCF0aGlzLnZpc2libGUoKSkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRNYXhTaXplXG4gICAgfVxuXG4gICAgY29uc3QgbWF4U2l6ZSA9IHRoaXMubm9ybWFsaXplU2l6ZUJvdW5kYXJ5KHRoaXMubWF4U2l6ZSwgZGVmYXVsdE1heFNpemUpXG4gICAgY29uc3Qgc2l6ZSA9IHRoaXMuc2l6ZSgpXG5cbiAgICBpZiAoc2l6ZSAhPT0gJyonICYmIHNpemUgIT09ICdhdXRvJyAmJiBzaXplID4gbWF4U2l6ZSkge1xuICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignYXMtc3BsaXQ6IHNpemUgY2Fubm90IGJlIGxhcmdlciB0aGFuIG1heFNpemUnKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGVmYXVsdE1heFNpemVcbiAgICB9XG5cbiAgICByZXR1cm4gbWF4U2l6ZVxuICB9XG5cbiAgcHJpdmF0ZSBub3JtYWxpemVTaXplQm91bmRhcnkoc2l6ZUJvdW5kYXJ5U2lnbmFsOiBTaWduYWw8U3BsaXRBcmVhU2l6ZT4sIGRlZmF1bHRCb3VuZGFyeVNpemU6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3Qgc2l6ZSA9IHRoaXMuc2l6ZSgpXG4gICAgY29uc3QgbG9ja1NpemUgPSB0aGlzLmxvY2tTaXplKClcbiAgICBjb25zdCBib3VuZGFyeVNpemUgPSBzaXplQm91bmRhcnlTaWduYWwoKVxuXG4gICAgaWYgKGxvY2tTaXplKSB7XG4gICAgICBpZiAoaXNEZXZNb2RlKCkgJiYgYm91bmRhcnlTaXplICE9PSAnKicpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdhcy1zcGxpdDogbG9ja1NpemUgb3ZlcndyaXRlcyBtYXhTaXplL21pblNpemUnKVxuICAgICAgfVxuXG4gICAgICBpZiAoc2l6ZSA9PT0gJyonIHx8IHNpemUgPT09ICdhdXRvJykge1xuICAgICAgICBpZiAoaXNEZXZNb2RlKCkpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oYGFzLXNwbGl0OiBsb2NrU2l6ZSBpc24ndCBzdXBwb3J0ZWQgb24gYXJlYSB3aXRoICogc2l6ZSBvciB3aXRob3V0IHNpemVgKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRlZmF1bHRCb3VuZGFyeVNpemVcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNpemVcbiAgICB9XG5cbiAgICBpZiAoYm91bmRhcnlTaXplID09PSAnKicpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0Qm91bmRhcnlTaXplXG4gICAgfVxuXG4gICAgaWYgKHNpemUgPT09ICcqJyB8fCBzaXplID09PSAnYXV0bycpIHtcbiAgICAgIGlmIChpc0Rldk1vZGUoKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ2FzLXNwbGl0OiBtYXhTaXplL21pblNpemUgbm90IGFsbG93ZWQgb24gKiBvciB3aXRob3V0IHNpemUnKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGVmYXVsdEJvdW5kYXJ5U2l6ZVxuICAgIH1cblxuICAgIHJldHVybiBib3VuZGFyeVNpemVcbiAgfVxufVxuIiwiPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuQGlmIChzcGxpdC5faXNEcmFnZ2luZygpKSB7XG4gIDxkaXYgY2xhc3M9XCJhcy1pZnJhbWUtZml4XCI+PC9kaXY+XG59XG4iXX0=